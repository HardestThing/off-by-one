# off-by-one
**off-by-one** is a *cache invalidation algorithm*

Most cache invalidation algorithms work by applying a *caching policy* to either *purge (delete)*, *refresh (replace)* or *ban (blacklist)* content from a cache.

Caching policies vary greatly, but some common ones are:

- First in first out (FIFO)
- Last in first out (LIFO)
- Least recently used (LRU)
- Time aware least recently used (TLRU)
- Most recently used (MRU)
- Pseudo-LRU (PLRU)
- Random replacement (RR)
- Segmented LRU (SLRU)
- Least-frequently used (LFU)
- Least frequent recently used (LFRU)
- LFU with dynamic aging (LFUDA)
- Low inter-reference recency set (LIRS)
- Adaptive replacement cache (ARC)
- Clock with adaptive replacement (CAR)
- Multi queue (MQ)

<sub>(list credit <a href="https://wikipedia.org/wiki/Cache_replacement_policies">Wikipedia</a>) </sub>

These policies each have advantages and disadvantages, but they all share one property:

***They assume that the cache was in a coherent, usable state at some point in the past***

**off-by-one** presents a new, different approach to cache invalidation through the use of a new, different caching policy; the **Most Recently Written (MRW)** policy.

This policy can be applied to any cache, to either purge, refresh or ban cached data as soon as possible after it's cached.

This policy not only ensures that the cache is invalid **at all times**, but when used to purge or replace cached data, it can in many cases lead to **significant memory savings**.

####Data Flow Diagram

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="312px" viewBox="-0.5 -0.5 312 262" content="&lt;mxfile host=&quot;www.draw.io&quot; modified=&quot;2019-12-30T13:17:05.884Z&quot; agent=&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36&quot; etag=&quot;URu9ILnndtDi67CJ0Bs7&quot; version=&quot;12.4.7&quot; type=&quot;google&quot;&gt;&lt;diagram name=&quot;Page-1&quot; id=&quot;74e2e168-ea6b-b213-b513-2b3c1d86103e&quot;&gt;3VjbjtowEP2aSO1DqzgmQB+Xy261EtKqVLvQN5OYxMKJI2Mg9OtrE+dqEBdtWVhe8Jzxbeacsa1YsB+lTxwl4Yj5mFqO7acWHFiOA2zbkX8K2WZIB7gZEHDi604lMCZ/cT5Soyvi42Wto2CMCpLUQY/FMfZEDUOcs02925zR+qoJCrABjD1ETfSN+CLUqAysdPzEJAj10l1XO2bIWwScrWK9nuXA+e6XuSOUz6X7L0Pks00FgkML9jljImtFaR9Tlds8bdm4xwPeYt8cx+KUAXP6Kp6f08Vb8jKZTzZ/Qveh903PskZ0pfMxjBKxldAXEkuU+F9V7pEXYh2F2OaZC0VEZQtYsLcJicDjBHnKtZFCkZjHIuJp/1JwtijyK0PvzVksHlFEqJJNf9fVsccoXsq/0Vh3GOvF1BRmuPneMRc4rUA6/CfMIiy4ikV7W5oJrdS2NjcV2nOywgrjeT+klRYUE5fZlg2d8DOS7xjJHyCB1I44EQLHltOmcg+9GZetQLUEO8gGD1k0W8kt9iq8SAKDWLY9mTTM74aoJlOtPUzZe5gqwHenChpUvari+Dy14cB6yotj68Oqo2WkfPTrzSyJhFHibU2c44it5cViOPxdjX3i6nEbTNofXj2uQaVJgLpIsZrEPppUHPsP6uaX5owyb/E7JHGdubPTjlMiJpX2VG3ku6utQar3tTO2uRHL3EyqRmWUMsthOysfd5DiJVtxDx+/rQXiARbHLxbs154+pmAqinD3CCLHOKZIkHX9wbRPJHqFF0ZkZIUeQacuSAAaOsvi1qOqL5jGRMWZ1LjA83myvBjz7CRbRH25itt3o+JSudOK55iKS+FOa7p9bxU7J6oY3pSKnR8HjtVzVQwbjxvgXlfGnfuR8SWHMbjWYQxPlHHrpmQMmq8DeOlhbDdk3L2ujLv3I+PaaWxfdBqD/ybj1okyBjcl4+aToim+U1UMGk8K0CyHi1UszfLbTta9/IAGh/8A&lt;/diagram&gt;&lt;/mxfile&gt;" onclick="(function(svg){var src=window.event.target||window.event.srcElement;while (src!=null&amp;&amp;src.nodeName.toLowerCase()!='a'){src=src.parentNode;}if(src==null){if(svg.wnd!=null&amp;&amp;!svg.wnd.closed){svg.wnd.focus();}else{var r=function(evt){if(evt.data=='ready'&amp;&amp;evt.source==svg.wnd){svg.wnd.postMessage(decodeURIComponent(svg.getAttribute('content')),'*');window.removeEventListener('message',r);}};window.addEventListener('message',r);svg.wnd=window.open('https://www.draw.io/?client=1&amp;lightbox=1&amp;edit=_blank');}}})(this);" style="cursor:pointer;max-width:100%;max-height:262px;"><defs/><g><path d="M 1 21 L 1 21.64 L 11 20.47 L 21 21.62 L 31 21.1 L 41 21.05 L 51 20.31 L 61 21.57 L 71 21.17 L 81 20.65 L 91 21.71 L 101 21.24 L 111 20.27 L 121 21 L 120.88 21 L 121.36 31 L 121.02 41 L 120.77 51 L 121.67 61 L 120.67 71 L 121 81 L 121 81.46 L 111 80.39 L 101 80.38 L 91 81.25 L 81 81.7 L 71 81.12 L 61 81.49 L 51 80.9 L 41 81.54 L 31 81.39 L 21 80.82 L 11 81.33 L 1 81 L 1.33 81 L 0.55 71 L 0.42 61 L 1.66 51 L 1.54 41 L 0.5 31 L 1 21 L 1 21 Z Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(2.5,37.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="115" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: &quot;Comic Sans MS&quot;; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 115px; white-space: nowrap; overflow-wrap: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Empty (invalid) cache</div></div></foreignObject><text x="58" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS" font-weight="bold">Empty (invalid) cache</text></switch></g><path d="M 251 1 L 251.25 1.25 L 258.09 8.09 L 264.8 14.8 L 272.73 22.73 L 280.13 30.13 L 287.41 37.41 L 294.41 44.41 L 301 51 L 301.63 51.63 L 293.15 57.44 L 287.02 65.59 L 279.51 72.37 L 272.06 79.2 L 264.68 86.11 L 258.6 94.32 L 251 101 L 250.78 100.78 L 244.03 94.03 L 236.89 86.89 L 229.66 79.66 L 221.9 71.9 L 215.03 65.03 L 208.42 58.42 L 201 51 L 200.39 50.39 L 207.83 43.55 L 214.87 36.3 L 221.84 28.99 L 229.19 22.04 L 236.12 14.7 L 243.36 7.65 L 251 1 Z Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(212.5,37.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="75" height="26" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: &quot;Comic Sans MS&quot;; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 75px; white-space: nowrap; overflow-wrap: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Data written<br />to cache</div></div></foreignObject><text x="38" y="19" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS" font-weight="bold">Data written&lt;br&gt;to cache</text></switch></g><path d="M 191 181 L 191 180.3 L 201 181.2 L 211 180.31 L 221 181.62 L 231 180.77 L 241 181.66 L 251 180.38 L 261 181.03 L 271 180.47 L 281 180.63 L 291 180.54 L 301 181.23 L 311 181 L 310.66 181 L 310.58 191 L 310.77 201 L 311.52 211 L 311.26 221 L 310.72 231 L 311 241 L 311 241.22 L 301 241.26 L 291 241.08 L 281 240.55 L 271 240.81 L 261 240.36 L 251 241.01 L 241 241.31 L 231 240.9 L 221 240.33 L 211 240.48 L 201 240.68 L 191 241 L 190.48 241 L 191.25 231 L 191.24 221 L 191.17 211 L 191.66 201 L 191.41 191 L 191 181 L 191 181 Z Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(216.5,204.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="67" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: &quot;Comic Sans MS&quot;; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 67px; white-space: nowrap; overflow-wrap: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">Valid cache</div></div></foreignObject><text x="34" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS" font-weight="bold">Valid cache</text></switch></g><path d="M 61 161 L 61.07 161.07 L 67.94 167.94 L 75.62 175.62 L 83.06 183.06 L 89.14 189.14 L 96.64 196.64 L 103.86 203.86 L 111 211 L 111.55 211.55 L 104.16 218.44 L 96.35 224.92 L 89.52 232.38 L 82.45 239.59 L 75.83 247.25 L 67.7 253.41 L 61 261 L 61.5 261.5 L 53.95 253.95 L 46.79 246.79 L 39.53 239.53 L 32.06 232.06 L 25.75 225.75 L 18.28 218.28 L 11 211 L 10.31 210.31 L 17.95 203.67 L 25.77 197.2 L 32.19 189.33 L 40.11 182.96 L 46.81 175.39 L 54.41 168.69 L 61 161 Z Z" fill="#ffffff" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(36.5,183.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="47" height="54" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: &quot;Comic Sans MS&quot;; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 47px; white-space: nowrap; overflow-wrap: normal; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;">MRW<br />policy<br />removes<br />data</div></div></foreignObject><text x="24" y="33" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS" font-weight="bold">[Not supported by viewer]</text></switch></g><path d="M 121 51 L 121 50.3 L 130.97 51.24 L 140.93 51.22 L 150.9 50.96 L 160.87 51.57 L 170.83 51.1 L 180.8 50.4 L 190.76 51" fill="none" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 198.76 51 L 198.83 51.2 L 197.19 51.61 L 195.64 52.29 L 193.94 52.53 L 192.31 52.98 L 190.76 53.67 L 191.01 53.67 L 190.87 52.6 L 190.66 51.53 L 190.72 50.47 L 190.82 49.4 L 190.76 48.33 L 190.7 48.16 L 192.3 48.68 L 194 49.5 L 195.63 50.14 L 197.23 50.65 L 198.76 51 Z Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><path d="M 251 101 L 251.59 101 L 251.58 110.97 L 250.44 120.93 L 251.62 130.9 L 251.21 140.87 L 250.49 150.83 L 251.3 160.8 L 251 170.76" fill="none" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 251 178.76 L 251.12 178.8 L 250.5 177.18 L 249.89 175.55 L 249.25 173.91 L 248.86 172.36 L 248.33 170.76 L 248.33 170.73 L 249.4 170.92 L 250.47 170.93 L 251.53 170.71 L 252.6 170.64 L 253.67 170.76 L 253.48 170.7 L 253.29 172.42 L 252.48 173.93 L 251.88 175.5 L 251.31 177.09 L 251 178.76 Z Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><path d="M 191 211 L 191 210.99 L 181.03 211.26 L 171.07 210.68 L 161.1 211.27 L 151.13 211.7 L 141.17 211.28 L 131.2 211.62 L 121.24 211" fill="none" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 113.24 211 L 113.26 211.06 L 114.86 210.53 L 116.38 209.76 L 117.97 209.22 L 119.7 209.06 L 121.24 208.33 L 121.08 208.33 L 121 209.4 L 121.2 210.47 L 121.14 211.53 L 121.33 212.6 L 121.24 213.67 L 121.28 213.8 L 119.58 212.98 L 118.09 212.76 L 116.38 211.91 L 114.85 211.56 L 113.24 211 Z Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/><path d="M 61 161 L 60.98 161 L 60.29 151.03 L 61.29 141.07 L 61.5 131.1 L 61.75 121.13 L 61.11 111.17 L 60.97 101.2 L 61 91.24" fill="none" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 61 83.24 L 60.89 83.2 L 61.69 84.89 L 62.12 86.45 L 62.53 88.01 L 63.13 89.63 L 63.67 91.24 L 63.67 91.05 L 62.6 91.29 L 61.53 91.04 L 60.47 91.32 L 59.4 91.3 L 58.33 91.24 L 58.22 91.2 L 58.75 89.6 L 59.19 87.97 L 59.81 86.39 L 60.35 84.8 L 61 83.24 Z Z" fill="#000000" stroke="#000000" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="all"/></g></svg>

This new development in cache invalidation algorithms should hopefully help to remove one of [the hardest problems](https://martinfowler.com/bliki/TwoHardThings.html) [in Computer Science](https://twitter.com/secretGeek/status/7269997868).